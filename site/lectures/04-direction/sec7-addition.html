<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combining Directions | Vector Addition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --text-primary: #e8e6e3;
            --text-secondary: #a9a6a0;
            --text-muted: #6b6966;
            --accent-blue: #4a9eff;
            --accent-purple: #9d7aff;
            --accent-green: #4ade80;
            --accent-red: #f87171;
            --accent-yellow: #fbbf24;
            --accent-cyan: #22d3ee;
            --accent-orange: #fb923c;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1, h2, h3 {
            font-family: 'Fraunces', serif;
            font-weight: 600;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.6rem;
            color: var(--accent-green);
            margin: 3rem 0 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        h3 {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin: 2rem 0 1rem;
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .visual-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid var(--bg-tertiary);
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1.5rem;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        input[type="range"] {
            width: 120px;
            accent-color: var(--accent-green);
        }

        .value-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-green);
        }

        .formula-box {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-green);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            border-radius: 0 8px 8px 0;
        }

        .formula-box .main {
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .formula-box .explanation {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(34, 211, 238, 0.1));
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .insight-box h4 {
            color: var(--accent-cyan);
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .causal-chain {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .chain-step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-tertiary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chain-step:hover {
            transform: translateX(5px);
            border-left: 3px solid var(--accent-green);
        }

        .chain-step.active {
            border-left: 3px solid var(--accent-cyan);
            background: rgba(34, 211, 238, 0.1);
        }

        .chain-arrow {
            color: var(--accent-green);
            font-size: 1.5rem;
            text-align: center;
            padding: 0.5rem 0;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: var(--accent-green);
            color: var(--bg-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            color: var(--text-primary);
            font-weight: 500;
        }

        .step-detail {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: none;
        }

        .chain-step.active .step-detail {
            display: block;
            margin-top: 0.5rem;
        }

        .method-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .method-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .method-btn:hover {
            border-color: var(--accent-green);
        }

        .method-btn.active {
            background: var(--accent-green);
            color: var(--bg-primary);
            border-color: var(--accent-green);
        }

        .molecule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .molecule-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--bg-tertiary);
            text-align: center;
            transition: all 0.3s ease;
        }

        .molecule-card:hover {
            border-color: var(--accent-green);
            transform: translateY(-2px);
        }

        .molecule-card h4 {
            color: var(--accent-cyan);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .molecule-card canvas {
            margin: 1rem 0;
        }

        .molecule-card .result {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .molecule-card .result.polar {
            color: var(--accent-yellow);
        }

        .molecule-card .result.nonpolar {
            color: var(--accent-green);
        }

        .practice-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin: 3rem 0;
        }

        .problem {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .problem-question {
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .problem-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .option-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            border-color: var(--accent-green);
            color: var(--text-primary);
        }

        .option-btn.correct {
            background: var(--accent-green);
            color: var(--bg-primary);
            border-color: var(--accent-green);
        }

        .option-btn.incorrect {
            background: var(--accent-red);
            color: var(--bg-primary);
            border-color: var(--accent-red);
        }

        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .feedback.incorrect {
            background: rgba(248, 113, 113, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        .result-display {
            text-align: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-top: 1rem;
        }

        .sum-value {
            font-size: 1.5rem;
            font-family: 'Fraunces', serif;
            font-weight: 600;
            color: var(--accent-yellow);
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-green);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            margin: 2rem 0;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 3rem;
        }

        .completion-banner {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(157, 122, 255, 0.1));
            border: 2px solid var(--accent-green);
            border-radius: 12px;
            padding: 2rem;
            margin: 3rem 0;
            text-align: center;
        }

        .completion-banner h3 {
            color: var(--accent-green);
            margin-bottom: 1rem;
        }

        .completion-banner p {
            color: var(--text-secondary);
            margin-bottom: 0;
        }

        .tools-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .tool-badge {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--bg-tertiary);
        }

        .tool-badge .tool-name {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-cyan);
            font-size: 0.9rem;
        }

        .tool-badge .tool-symbol {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="sec6-cross-product.html" class="nav-link">← Section 6: What's Perpendicular?</a>

        <h1>Combining Directions</h1>
        <p class="subtitle">How multiple effects add up to a single result</p>

        <!-- Opening Visual: Water molecule with net dipole -->
        <div class="visual-container">
            <canvas id="dipoleCanvas" width="700" height="400"></canvas>
            <div class="controls">
                <div class="control-group">
                    <label>Bond Angle</label>
                    <input type="range" id="bondAngle" min="90" max="180" value="104.5" step="0.5">
                    <span class="value-display" id="bondAngleVal">104.5°</span>
                </div>
            </div>
            <div class="result-display">
                <div class="sum-value" id="netDipole">Net Dipole: 1.85 D</div>
                <div style="color: var(--text-muted); margin-top: 0.5rem;">
                    Two bond dipoles combine to give a net molecular dipole
                </div>
            </div>
        </div>

        <p>When multiple forces, dipoles, or velocities act at once, how do they combine? Vector addition tells us: place them tip-to-tail, and draw the result from start to finish.</p>

        <!-- Causal Chain -->
        <h2>Why Combining Matters</h2>

        <div class="causal-chain">
            <div class="chain-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">Each bond has a dipole</div>
                    <div class="step-detail">O-H bond: electrons pulled toward oxygen</div>
                </div>
            </div>
            <div class="chain-arrow">↓</div>
            <div class="chain-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Dipoles add as vectors</div>
                    <div class="step-detail">Direction and magnitude both matter</div>
                </div>
            </div>
            <div class="chain-arrow">↓</div>
            <div class="chain-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">Net dipole determines polarity</div>
                    <div class="step-detail">Nonzero sum → polar molecule</div>
                </div>
            </div>
            <div class="chain-arrow">↓</div>
            <div class="chain-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">Polarity determines behavior</div>
                    <div class="step-detail">Solubility, boiling point, reactivity</div>
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h4>THE KEY PRINCIPLE</h4>
            <p>Vectors add by placing them tip-to-tail. The sum goes from the first tail to the last tip. This works for forces, dipoles, velocities, displacements—any directed quantity.</p>
        </div>

        <!-- The Two Methods -->
        <h2>Two Methods, Same Answer</h2>

        <div class="method-toggle">
            <button class="method-btn active" data-method="geometric">Tip-to-Tail</button>
            <button class="method-btn" data-method="component">Components</button>
            <button class="method-btn" data-method="both">Both</button>
        </div>

        <div class="visual-container">
            <canvas id="methodCanvas" width="700" height="400"></canvas>
            <div class="controls">
                <div class="control-group">
                    <label>a angle</label>
                    <input type="range" id="aAng" min="0" max="360" value="30">
                    <span class="value-display" id="aAngVal">30°</span>
                </div>
                <div class="control-group">
                    <label>|a|</label>
                    <input type="range" id="aMag" min="30" max="120" value="80">
                    <span class="value-display" id="aMagVal">0.80</span>
                </div>
                <div class="control-group">
                    <label>b angle</label>
                    <input type="range" id="bAng" min="0" max="360" value="120">
                    <span class="value-display" id="bAngVal">120°</span>
                </div>
                <div class="control-group">
                    <label>|b|</label>
                    <input type="range" id="bMag" min="30" max="120" value="100">
                    <span class="value-display" id="bMagVal">1.00</span>
                </div>
            </div>
            <div class="result-display">
                <div class="sum-value" id="sumResult">a + b = (1.09, 1.27)</div>
                <div style="color: var(--text-muted); margin-top: 0.5rem;" id="sumMag">
                    |a + b| = 1.67
                </div>
            </div>
        </div>

        <div class="formula-box">
            <div class="main">(a₁, a₂) + (b₁, b₂) = (a₁ + b₁, a₂ + b₂)</div>
            <div class="explanation">Add corresponding components—x with x, y with y</div>
        </div>

        <!-- Molecular Dipoles -->
        <h2>Molecular Geometry → Net Dipole</h2>

        <p>The same bond dipoles can give very different results depending on molecular geometry:</p>

        <div class="molecule-grid">
            <div class="molecule-card">
                <h4>H₂O</h4>
                <canvas id="h2oCanvas" width="180" height="150"></canvas>
                <div class="result polar">Polar (1.85 D)</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                    Bent shape → dipoles reinforce
                </div>
            </div>
            <div class="molecule-card">
                <h4>CO₂</h4>
                <canvas id="co2Canvas" width="180" height="150"></canvas>
                <div class="result nonpolar">Nonpolar (0 D)</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                    Linear → dipoles cancel exactly
                </div>
            </div>
            <div class="molecule-card">
                <h4>NH₃</h4>
                <canvas id="nh3Canvas" width="180" height="150"></canvas>
                <div class="result polar">Polar (1.47 D)</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                    Pyramidal → dipoles add up
                </div>
            </div>
            <div class="molecule-card">
                <h4>BF₃</h4>
                <canvas id="bf3Canvas" width="180" height="150"></canvas>
                <div class="result nonpolar">Nonpolar (0 D)</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                    Trigonal planar → symmetric cancellation
                </div>
            </div>
        </div>

        <!-- Force Balance -->
        <h2>Force Balance: Equilibrium</h2>

        <div class="visual-container">
            <canvas id="forceCanvas" width="700" height="350"></canvas>
            <div class="controls">
                <div class="control-group">
                    <label>F₁ angle</label>
                    <input type="range" id="f1Ang" min="0" max="180" value="45">
                    <span class="value-display" id="f1AngVal">45°</span>
                </div>
                <div class="control-group">
                    <label>F₂ angle</label>
                    <input type="range" id="f2Ang" min="180" max="360" value="315">
                    <span class="value-display" id="f2AngVal">315°</span>
                </div>
            </div>
            <div class="result-display">
                <div class="sum-value" id="netForce">Net Force: 0.00</div>
                <div style="color: var(--text-muted); margin-top: 0.5rem;" id="equilibriumStatus">
                    Equilibrium: Object stays stationary
                </div>
            </div>
        </div>

        <div class="insight-box">
            <h4>EQUILIBRIUM CONDITION</h4>
            <p>When all forces sum to zero, the object is in equilibrium. This is Newton's first law: no net force means no change in motion.</p>
        </div>

        <!-- Velocity Composition -->
        <h2>Velocity Addition: The River Problem</h2>

        <div class="visual-container">
            <canvas id="riverCanvas" width="700" height="350"></canvas>
            <div class="controls">
                <div class="control-group">
                    <label>Boat speed</label>
                    <input type="range" id="boatSpeed" min="1" max="10" value="5">
                    <span class="value-display" id="boatSpeedVal">5 m/s</span>
                </div>
                <div class="control-group">
                    <label>River speed</label>
                    <input type="range" id="riverSpeed" min="0" max="8" value="3">
                    <span class="value-display" id="riverSpeedVal">3 m/s</span>
                </div>
                <div class="control-group">
                    <label>Boat heading</label>
                    <input type="range" id="boatHeading" min="45" max="135" value="90">
                    <span class="value-display" id="boatHeadingVal">90° (straight across)</span>
                </div>
            </div>
            <div class="result-display">
                <div class="sum-value" id="actualVelocity">Actual: 5.83 m/s at 59°</div>
                <div style="color: var(--text-muted); margin-top: 0.5rem;" id="riverNote">
                    The boat moves diagonally relative to the shore
                </div>
            </div>
        </div>

        <!-- Practice Problems -->
        <h2>Practice</h2>

        <div class="practice-section">
            <div class="problem">
                <div class="problem-question">
                    <strong>Problem 1:</strong> If a = (3, 4) and b = (-1, 2), what is a + b?
                </div>
                <div class="problem-options">
                    <button class="option-btn" data-correct="true">(2, 6)</button>
                    <button class="option-btn">(4, 6)</button>
                    <button class="option-btn">(2, 2)</button>
                    <button class="option-btn">(4, 2)</button>
                </div>
                <div class="feedback" id="feedback1">
                    <strong>Correct!</strong> (3 + (-1), 4 + 2) = (2, 6). Add each component separately.
                </div>
            </div>

            <div class="problem">
                <div class="problem-question">
                    <strong>Problem 2:</strong> CCl₄ (carbon tetrachloride) has four polar C-Cl bonds arranged tetrahedrally. Is the molecule polar or nonpolar?
                </div>
                <div class="problem-options">
                    <button class="option-btn">Polar</button>
                    <button class="option-btn" data-correct="true">Nonpolar</button>
                </div>
                <div class="feedback" id="feedback2">
                    <strong>Correct!</strong> The tetrahedral symmetry means all four bond dipoles cancel perfectly, giving zero net dipole despite having polar bonds.
                </div>
            </div>

            <div class="problem">
                <div class="problem-question">
                    <strong>Problem 3:</strong> A plane flies north at 200 km/h. A wind blows east at 50 km/h. What's the plane's actual speed over the ground?
                </div>
                <div class="problem-options">
                    <button class="option-btn">250 km/h</button>
                    <button class="option-btn">150 km/h</button>
                    <button class="option-btn" data-correct="true">206 km/h</button>
                    <button class="option-btn">200 km/h</button>
                </div>
                <div class="feedback" id="feedback3">
                    <strong>Correct!</strong> √(200² + 50²) = √(40000 + 2500) = √42500 ≈ 206 km/h. Since the velocities are perpendicular, use Pythagorean theorem.
                </div>
            </div>

            <div class="problem">
                <div class="problem-question">
                    <strong>Problem 4:</strong> Three forces of equal magnitude act on a point, spaced 120° apart. What's the net force?
                </div>
                <div class="problem-options">
                    <button class="option-btn" data-correct="true">Zero</button>
                    <button class="option-btn">Equal to one force</button>
                    <button class="option-btn">Three times one force</button>
                    <button class="option-btn">√3 times one force</button>
                </div>
                <div class="feedback" id="feedback4">
                    <strong>Correct!</strong> Three equal vectors at 120° angles form a closed triangle when placed tip-to-tail, so they sum to zero. This is why BF₃ is nonpolar!
                </div>
            </div>
        </div>

        <!-- Completion Banner -->
        <div class="completion-banner">
            <h3>Lecture 04 Complete!</h3>
            <p>You've learned the complete toolkit for working with direction in chemistry:</p>
            <div class="tools-summary">
                <div class="tool-badge">
                    <div class="tool-symbol">→</div>
                    <div class="tool-name">Vectors</div>
                </div>
                <div class="tool-badge">
                    <div class="tool-symbol">|v|</div>
                    <div class="tool-name">Magnitude</div>
                </div>
                <div class="tool-badge">
                    <div class="tool-symbol">v̂</div>
                    <div class="tool-name">Unit Vectors</div>
                </div>
                <div class="tool-badge">
                    <div class="tool-symbol">vₓ, vᵧ</div>
                    <div class="tool-name">Components</div>
                </div>
                <div class="tool-badge">
                    <div class="tool-symbol">a · b</div>
                    <div class="tool-name">Dot Product</div>
                </div>
                <div class="tool-badge">
                    <div class="tool-symbol">a × b</div>
                    <div class="tool-name">Cross Product</div>
                </div>
                <div class="tool-badge">
                    <div class="tool-symbol">a + b</div>
                    <div class="tool-name">Addition</div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="sec6-cross-product.html" class="nav-link">← Section 6: Cross Product</a>
            <a href="../index.html" class="nav-link">Back to Lectures →</a>
        </div>
    </div>

    <script>
        // Helper function
        function drawArrow(ctx, x1, y1, x2, y2, color, width = 3) {
            const headLen = 12;
            const angle = Math.atan2(y2 - y1, x2 - x1);

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI/6), y2 - headLen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI/6), y2 - headLen * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }

        // === Water Dipole Visualization ===
        const dipoleCanvas = document.getElementById('dipoleCanvas');
        const dipoleCtx = dipoleCanvas.getContext('2d');
        const bondAngleSlider = document.getElementById('bondAngle');

        function drawDipole() {
            const bondAngle = parseFloat(bondAngleSlider.value);
            const halfAngle = bondAngle / 2 * Math.PI / 180;

            dipoleCtx.fillStyle = '#0a0a0f';
            dipoleCtx.fillRect(0, 0, 700, 400);

            const cx = 350, cy = 220;
            const bondLen = 80;
            const dipoleLen = 60;

            // Oxygen
            dipoleCtx.beginPath();
            dipoleCtx.arc(cx, cy, 30, 0, Math.PI * 2);
            dipoleCtx.fillStyle = '#f87171';
            dipoleCtx.fill();
            dipoleCtx.fillStyle = '#fff';
            dipoleCtx.font = '18px Inter';
            dipoleCtx.textAlign = 'center';
            dipoleCtx.fillText('O', cx, cy + 6);

            // Hydrogens
            const h1 = { x: cx - bondLen * Math.sin(halfAngle), y: cy - bondLen * Math.cos(halfAngle) };
            const h2 = { x: cx + bondLen * Math.sin(halfAngle), y: cy - bondLen * Math.cos(halfAngle) };

            // Bonds
            dipoleCtx.strokeStyle = '#6b6966';
            dipoleCtx.lineWidth = 6;
            dipoleCtx.beginPath();
            dipoleCtx.moveTo(cx, cy);
            dipoleCtx.lineTo(h1.x, h1.y);
            dipoleCtx.moveTo(cx, cy);
            dipoleCtx.lineTo(h2.x, h2.y);
            dipoleCtx.stroke();

            // Hydrogen atoms
            dipoleCtx.beginPath();
            dipoleCtx.arc(h1.x, h1.y, 18, 0, Math.PI * 2);
            dipoleCtx.fillStyle = '#fff';
            dipoleCtx.fill();
            dipoleCtx.beginPath();
            dipoleCtx.arc(h2.x, h2.y, 18, 0, Math.PI * 2);
            dipoleCtx.fill();
            dipoleCtx.fillStyle = '#333';
            dipoleCtx.font = '14px Inter';
            dipoleCtx.fillText('H', h1.x, h1.y + 5);
            dipoleCtx.fillText('H', h2.x, h2.y + 5);

            // Bond dipoles (pointing toward O, δ- end)
            const mid1 = { x: (cx + h1.x) / 2, y: (cy + h1.y) / 2 };
            const mid2 = { x: (cx + h2.x) / 2, y: (cy + h2.y) / 2 };
            const dir1 = { x: (cx - h1.x) / bondLen, y: (cy - h1.y) / bondLen };
            const dir2 = { x: (cx - h2.x) / bondLen, y: (cy - h2.y) / bondLen };

            // Draw bond dipoles
            drawArrow(dipoleCtx, mid1.x - dir1.x * 25, mid1.y - dir1.y * 25,
                      mid1.x + dir1.x * 25, mid1.y + dir1.y * 25, '#4a9eff', 3);
            drawArrow(dipoleCtx, mid2.x - dir2.x * 25, mid2.y - dir2.y * 25,
                      mid2.x + dir2.x * 25, mid2.y + dir2.y * 25, '#22d3ee', 3);

            // Show tip-to-tail addition
            const sumX = (dir1.x + dir2.x) * dipoleLen;
            const sumY = (dir1.y + dir2.y) * dipoleLen;

            // Draw the tip-to-tail version (smaller, to the side)
            const ttX = 550, ttY = 150;
            dipoleCtx.fillStyle = '#6b6966';
            dipoleCtx.font = '12px JetBrains Mono';
            dipoleCtx.textAlign = 'left';
            dipoleCtx.fillText('Tip-to-tail:', ttX - 30, ttY - 50);

            // First vector
            drawArrow(dipoleCtx, ttX, ttY, ttX + dir1.x * 40, ttY + dir1.y * 40, '#4a9eff', 2);
            // Second vector from tip of first
            const tip1X = ttX + dir1.x * 40;
            const tip1Y = ttY + dir1.y * 40;
            drawArrow(dipoleCtx, tip1X, tip1Y, tip1X + dir2.x * 40, tip1Y + dir2.y * 40, '#22d3ee', 2);
            // Sum vector
            const tip2X = tip1X + dir2.x * 40;
            const tip2Y = tip1Y + dir2.y * 40;
            drawArrow(dipoleCtx, ttX, ttY, tip2X, tip2Y, '#fbbf24', 3);

            // Net dipole on molecule
            if (Math.abs(sumY) > 0.1) {
                const netStartY = cy + 40;
                drawArrow(dipoleCtx, cx, netStartY, cx + sumX * 0.8, netStartY + sumY * 0.8, '#fbbf24', 4);
                dipoleCtx.fillStyle = '#fbbf24';
                dipoleCtx.textAlign = 'center';
                dipoleCtx.font = '14px JetBrains Mono';
                dipoleCtx.fillText('net dipole', cx, netStartY + sumY * 0.8 + 20);
            }

            // Update displays
            dipoleCtx.textAlign = 'left';
            document.getElementById('bondAngleVal').textContent = bondAngle + '°';

            // Calculate net dipole magnitude (simplified model)
            const netMag = Math.abs(2 * Math.cos(halfAngle) * 0.925);
            document.getElementById('netDipole').textContent = 'Net Dipole: ' + netMag.toFixed(2) + ' D';
        }

        bondAngleSlider.addEventListener('input', drawDipole);
        drawDipole();

        // === Method Visualization ===
        const methodCanvas = document.getElementById('methodCanvas');
        const methodCtx = methodCanvas.getContext('2d');
        const aAngSlider = document.getElementById('aAng');
        const aMagSlider = document.getElementById('aMag');
        const bAngSlider = document.getElementById('bAng');
        const bMagSlider = document.getElementById('bMag');
        let currentMethod = 'geometric';

        function drawMethod() {
            const aAng = parseFloat(aAngSlider.value) * Math.PI / 180;
            const aMag = parseFloat(aMagSlider.value);
            const bAng = parseFloat(bAngSlider.value) * Math.PI / 180;
            const bMag = parseFloat(bMagSlider.value);

            methodCtx.fillStyle = '#0a0a0f';
            methodCtx.fillRect(0, 0, 700, 400);

            const cx = 350, cy = 250;

            // Vector components
            const ax = aMag * Math.cos(aAng);
            const ay = -aMag * Math.sin(aAng);
            const bx = bMag * Math.cos(bAng);
            const by = -bMag * Math.sin(bAng);
            const sx = ax + bx;
            const sy = ay + by;

            // Grid
            methodCtx.strokeStyle = 'rgba(255,255,255,0.1)';
            methodCtx.lineWidth = 1;
            for (let i = -4; i <= 4; i++) {
                methodCtx.beginPath();
                methodCtx.moveTo(cx + i * 50, cy - 200);
                methodCtx.lineTo(cx + i * 50, cy + 150);
                methodCtx.stroke();
                methodCtx.beginPath();
                methodCtx.moveTo(cx - 200, cy + i * 50);
                methodCtx.lineTo(cx + 200, cy + i * 50);
                methodCtx.stroke();
            }

            // Axes
            methodCtx.strokeStyle = 'rgba(255,255,255,0.3)';
            methodCtx.lineWidth = 2;
            methodCtx.beginPath();
            methodCtx.moveTo(cx - 200, cy);
            methodCtx.lineTo(cx + 200, cy);
            methodCtx.moveTo(cx, cy + 150);
            methodCtx.lineTo(cx, cy - 200);
            methodCtx.stroke();

            if (currentMethod === 'geometric' || currentMethod === 'both') {
                // Tip-to-tail method
                // Draw a from origin
                drawArrow(methodCtx, cx, cy, cx + ax, cy + ay, '#4a9eff', 4);
                // Draw b from tip of a
                drawArrow(methodCtx, cx + ax, cy + ay, cx + ax + bx, cy + ay + by, '#22d3ee', 4);
                // Draw sum from origin to final tip
                if (Math.abs(sx) > 1 || Math.abs(sy) > 1) {
                    drawArrow(methodCtx, cx, cy, cx + sx, cy + sy, '#fbbf24', 4);
                }

                methodCtx.font = '14px JetBrains Mono';
                methodCtx.fillStyle = '#4a9eff';
                methodCtx.fillText('a', cx + ax/2 - 15, cy + ay/2 - 10);
                methodCtx.fillStyle = '#22d3ee';
                methodCtx.fillText('b', cx + ax + bx/2 + 10, cy + ay + by/2);
            }

            if (currentMethod === 'component' || currentMethod === 'both') {
                // Component method
                methodCtx.setLineDash([5, 5]);

                // a components
                methodCtx.strokeStyle = 'rgba(74, 158, 255, 0.5)';
                methodCtx.lineWidth = 2;
                methodCtx.beginPath();
                methodCtx.moveTo(cx, cy);
                methodCtx.lineTo(cx + ax, cy);
                methodCtx.lineTo(cx + ax, cy + ay);
                methodCtx.stroke();

                // b components
                methodCtx.strokeStyle = 'rgba(34, 211, 238, 0.5)';
                methodCtx.beginPath();
                methodCtx.moveTo(cx, cy);
                methodCtx.lineTo(cx + bx, cy);
                methodCtx.lineTo(cx + bx, cy + by);
                methodCtx.stroke();

                // sum components
                methodCtx.strokeStyle = 'rgba(251, 191, 36, 0.5)';
                methodCtx.beginPath();
                methodCtx.moveTo(cx, cy);
                methodCtx.lineTo(cx + sx, cy);
                methodCtx.lineTo(cx + sx, cy + sy);
                methodCtx.stroke();

                methodCtx.setLineDash([]);
            }

            // If only component view, draw vectors from origin
            if (currentMethod === 'component') {
                drawArrow(methodCtx, cx, cy, cx + ax, cy + ay, '#4a9eff', 4);
                drawArrow(methodCtx, cx, cy, cx + bx, cy + by, '#22d3ee', 4);
                drawArrow(methodCtx, cx, cy, cx + sx, cy + sy, '#fbbf24', 4);
            }

            // Labels
            methodCtx.fillStyle = '#fbbf24';
            methodCtx.font = '14px JetBrains Mono';
            methodCtx.fillText('a + b', cx + sx + 10, cy + sy);

            // Update displays
            document.getElementById('aAngVal').textContent = aAngSlider.value + '°';
            document.getElementById('aMagVal').textContent = (aMag / 100).toFixed(2);
            document.getElementById('bAngVal').textContent = bAngSlider.value + '°';
            document.getElementById('bMagVal').textContent = (bMag / 100).toFixed(2);

            const sumMag = Math.sqrt(sx * sx + sy * sy) / 100;
            document.getElementById('sumResult').textContent =
                'a + b = (' + (sx / 100).toFixed(2) + ', ' + (-sy / 100).toFixed(2) + ')';
            document.getElementById('sumMag').textContent = '|a + b| = ' + sumMag.toFixed(2);
        }

        [aAngSlider, aMagSlider, bAngSlider, bMagSlider].forEach(s => s.addEventListener('input', drawMethod));

        document.querySelectorAll('.method-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMethod = btn.dataset.method;
                drawMethod();
            });
        });

        drawMethod();

        // === Molecule Visualizations ===
        function drawMolecule(canvasId, type) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#12121a';
            ctx.fillRect(0, 0, 180, 150);

            const cx = 90, cy = 85;

            if (type === 'h2o') {
                // Water - bent
                const halfAngle = 52.25 * Math.PI / 180;
                drawMoleculeAtom(ctx, cx, cy, 15, '#f87171', 'O');
                drawMoleculeAtom(ctx, cx - 35 * Math.sin(halfAngle), cy - 35 * Math.cos(halfAngle), 10, '#fff', 'H');
                drawMoleculeAtom(ctx, cx + 35 * Math.sin(halfAngle), cy - 35 * Math.cos(halfAngle), 10, '#fff', 'H');

                // Dipoles
                drawArrow(ctx, cx - 15, cy - 20, cx - 5, cy - 5, '#4a9eff', 2);
                drawArrow(ctx, cx + 15, cy - 20, cx + 5, cy - 5, '#22d3ee', 2);
                // Net
                drawArrow(ctx, cx, cy + 20, cx, cy + 45, '#fbbf24', 3);
            }
            else if (type === 'co2') {
                // CO2 - linear
                drawMoleculeAtom(ctx, cx, cy, 15, '#6b6966', 'C');
                drawMoleculeAtom(ctx, cx - 45, cy, 12, '#f87171', 'O');
                drawMoleculeAtom(ctx, cx + 45, cy, 12, '#f87171', 'O');

                // Dipoles (cancel)
                drawArrow(ctx, cx - 15, cy - 15, cx - 35, cy - 15, '#4a9eff', 2);
                drawArrow(ctx, cx + 15, cy - 15, cx + 35, cy - 15, '#22d3ee', 2);
                // Zero net
                ctx.fillStyle = '#fbbf24';
                ctx.font = '12px JetBrains Mono';
                ctx.textAlign = 'center';
                ctx.fillText('= 0', cx, cy + 35);
            }
            else if (type === 'nh3') {
                // NH3 - pyramidal (2D representation)
                drawMoleculeAtom(ctx, cx, cy, 15, '#4a9eff', 'N');
                drawMoleculeAtom(ctx, cx - 35, cy + 25, 10, '#fff', 'H');
                drawMoleculeAtom(ctx, cx + 35, cy + 25, 10, '#fff', 'H');
                drawMoleculeAtom(ctx, cx, cy - 35, 10, '#fff', 'H');

                // Net dipole upward (simplified)
                drawArrow(ctx, cx, cy - 45, cx, cy - 70, '#fbbf24', 3);
            }
            else if (type === 'bf3') {
                // BF3 - trigonal planar
                drawMoleculeAtom(ctx, cx, cy, 12, '#f87171', 'B');
                const angles = [90, 210, 330];
                angles.forEach(a => {
                    const rad = a * Math.PI / 180;
                    drawMoleculeAtom(ctx, cx + 35 * Math.cos(rad), cy - 35 * Math.sin(rad), 10, '#4ade80', 'F');
                });
                // Zero net
                ctx.fillStyle = '#fbbf24';
                ctx.font = '12px JetBrains Mono';
                ctx.textAlign = 'center';
                ctx.fillText('= 0', cx, cy + 45);
            }
        }

        function drawMoleculeAtom(ctx, x, y, r, color, label) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.fillStyle = color === '#fff' ? '#333' : '#fff';
            ctx.font = (r > 12 ? '12' : '10') + 'px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(label, x, y + 4);
        }

        drawMolecule('h2oCanvas', 'h2o');
        drawMolecule('co2Canvas', 'co2');
        drawMolecule('nh3Canvas', 'nh3');
        drawMolecule('bf3Canvas', 'bf3');

        // === Force Balance ===
        const forceCanvas = document.getElementById('forceCanvas');
        const forceCtx = forceCanvas.getContext('2d');
        const f1AngSlider = document.getElementById('f1Ang');
        const f2AngSlider = document.getElementById('f2Ang');

        function drawForce() {
            const f1Ang = parseFloat(f1AngSlider.value) * Math.PI / 180;
            const f2Ang = parseFloat(f2AngSlider.value) * Math.PI / 180;

            forceCtx.fillStyle = '#0a0a0f';
            forceCtx.fillRect(0, 0, 700, 350);

            const cx = 350, cy = 200;
            const fMag = 80;

            // Object
            forceCtx.beginPath();
            forceCtx.arc(cx, cy, 25, 0, Math.PI * 2);
            forceCtx.fillStyle = '#6b6966';
            forceCtx.fill();

            // Gravity (always down)
            const gx = 0, gy = fMag;
            drawArrow(forceCtx, cx, cy, cx + gx, cy + gy, '#f87171', 4);
            forceCtx.fillStyle = '#f87171';
            forceCtx.font = '14px JetBrains Mono';
            forceCtx.fillText('W', cx + 10, cy + gy);

            // Force 1
            const f1x = fMag * Math.cos(f1Ang);
            const f1y = -fMag * Math.sin(f1Ang);
            drawArrow(forceCtx, cx, cy, cx + f1x, cy + f1y, '#4a9eff', 4);
            forceCtx.fillStyle = '#4a9eff';
            forceCtx.fillText('F₁', cx + f1x + 10, cy + f1y);

            // Force 2
            const f2x = fMag * Math.cos(f2Ang);
            const f2y = -fMag * Math.sin(f2Ang);
            drawArrow(forceCtx, cx, cy, cx + f2x, cy + f2y, '#22d3ee', 4);
            forceCtx.fillStyle = '#22d3ee';
            forceCtx.fillText('F₂', cx + f2x + 10, cy + f2y);

            // Net force
            const netX = f1x + f2x + gx;
            const netY = f1y + f2y + gy;
            const netMag = Math.sqrt(netX * netX + netY * netY);

            if (netMag > 5) {
                drawArrow(forceCtx, cx, cy, cx + netX, cy + netY, '#fbbf24', 4);
            }

            // Update displays
            document.getElementById('f1AngVal').textContent = f1AngSlider.value + '°';
            document.getElementById('f2AngVal').textContent = f2AngSlider.value + '°';
            document.getElementById('netForce').textContent = 'Net Force: ' + (netMag / fMag).toFixed(2);

            if (netMag < 5) {
                document.getElementById('equilibriumStatus').textContent = 'Equilibrium: Object stays stationary';
                document.getElementById('equilibriumStatus').style.color = '#4ade80';
            } else {
                document.getElementById('equilibriumStatus').textContent = 'Not in equilibrium: Object accelerates';
                document.getElementById('equilibriumStatus').style.color = '#fbbf24';
            }
        }

        [f1AngSlider, f2AngSlider].forEach(s => s.addEventListener('input', drawForce));
        drawForce();

        // === River Problem ===
        const riverCanvas = document.getElementById('riverCanvas');
        const riverCtx = riverCanvas.getContext('2d');
        const boatSpeedSlider = document.getElementById('boatSpeed');
        const riverSpeedSlider = document.getElementById('riverSpeed');
        const boatHeadingSlider = document.getElementById('boatHeading');

        let riverTime = 0;
        function drawRiver() {
            const boatSpeed = parseFloat(boatSpeedSlider.value);
            const riverSpeed = parseFloat(riverSpeedSlider.value);
            const heading = parseFloat(boatHeadingSlider.value) * Math.PI / 180;

            riverCtx.fillStyle = '#0a0a0f';
            riverCtx.fillRect(0, 0, 700, 350);

            // River
            riverCtx.fillStyle = '#1a3a5c';
            riverCtx.fillRect(100, 50, 500, 250);

            // Banks
            riverCtx.fillStyle = '#2a4a2a';
            riverCtx.fillRect(0, 50, 100, 250);
            riverCtx.fillRect(600, 50, 100, 250);

            // Flow lines
            riverCtx.strokeStyle = 'rgba(74, 158, 255, 0.3)';
            riverCtx.lineWidth = 1;
            for (let y = 80; y < 280; y += 30) {
                riverCtx.beginPath();
                const offset = (riverTime * riverSpeed * 5) % 50;
                for (let x = 100 + offset; x < 600; x += 50) {
                    riverCtx.moveTo(x, y);
                    riverCtx.lineTo(x + 20, y);
                }
                riverCtx.stroke();
            }

            // Boat position (animated)
            const bx = 150 + (riverTime * riverSpeed * 3) % 400;
            const by = 300 - (riverTime * boatSpeed * Math.sin(heading) * 3) % 200;

            // Boat
            riverCtx.save();
            riverCtx.translate(bx, by);
            riverCtx.rotate(-heading + Math.PI/2);
            riverCtx.beginPath();
            riverCtx.moveTo(0, -15);
            riverCtx.lineTo(10, 15);
            riverCtx.lineTo(-10, 15);
            riverCtx.closePath();
            riverCtx.fillStyle = '#fbbf24';
            riverCtx.fill();
            riverCtx.restore();

            // Vector diagram (to the side)
            const vx = 550, vy = 175;
            const scale = 8;

            // Boat velocity (heading direction)
            const bvx = boatSpeed * Math.cos(heading) * scale;
            const bvy = -boatSpeed * Math.sin(heading) * scale;
            drawArrow(riverCtx, vx, vy, vx + bvx, vy + bvy, '#fbbf24', 3);
            riverCtx.fillStyle = '#fbbf24';
            riverCtx.font = '12px JetBrains Mono';
            riverCtx.fillText('boat', vx + bvx + 5, vy + bvy - 5);

            // River velocity (always right)
            const rvx = riverSpeed * scale;
            drawArrow(riverCtx, vx + bvx, vy + bvy, vx + bvx + rvx, vy + bvy, '#4a9eff', 3);
            riverCtx.fillStyle = '#4a9eff';
            riverCtx.fillText('river', vx + bvx + rvx/2, vy + bvy + 15);

            // Actual velocity (sum)
            const avx = bvx + rvx;
            const avy = bvy;
            drawArrow(riverCtx, vx, vy, vx + avx, vy + avy, '#4ade80', 4);
            riverCtx.fillStyle = '#4ade80';
            riverCtx.fillText('actual', vx + avx + 5, vy + avy);

            // Update displays
            document.getElementById('boatSpeedVal').textContent = boatSpeed + ' m/s';
            document.getElementById('riverSpeedVal').textContent = riverSpeed + ' m/s';

            const headingDeg = boatHeadingSlider.value;
            let headingLabel = headingDeg + '°';
            if (headingDeg == 90) headingLabel += ' (straight across)';
            else if (headingDeg < 90) headingLabel += ' (upstream)';
            else headingLabel += ' (downstream)';
            document.getElementById('boatHeadingVal').textContent = headingLabel;

            const actualSpeed = Math.sqrt((boatSpeed * Math.cos(heading) + riverSpeed) ** 2 +
                                          (boatSpeed * Math.sin(heading)) ** 2);
            const actualAngle = Math.atan2(boatSpeed * Math.sin(heading),
                                           boatSpeed * Math.cos(heading) + riverSpeed) * 180 / Math.PI;

            document.getElementById('actualVelocity').textContent =
                'Actual: ' + actualSpeed.toFixed(2) + ' m/s at ' + actualAngle.toFixed(0) + '°';

            riverTime += 0.02;
            requestAnimationFrame(drawRiver);
        }

        [boatSpeedSlider, riverSpeedSlider, boatHeadingSlider].forEach(s => s.addEventListener('input', () => {}));
        drawRiver();

        // === Causal Chain Interaction ===
        document.querySelectorAll('.chain-step').forEach(step => {
            step.addEventListener('click', () => {
                document.querySelectorAll('.chain-step').forEach(s => s.classList.remove('active'));
                step.classList.add('active');
            });
        });

        // === Practice Problems ===
        document.querySelectorAll('.problem-options').forEach((options, i) => {
            const feedback = document.getElementById('feedback' + (i + 1));
            options.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const isCorrect = btn.dataset.correct === 'true';

                    options.querySelectorAll('.option-btn').forEach(b => {
                        b.disabled = true;
                        if (b.dataset.correct === 'true') b.classList.add('correct');
                        else if (b === btn && !isCorrect) b.classList.add('incorrect');
                    });

                    feedback.classList.add('show');
                    feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
                    if (!isCorrect) {
                        feedback.innerHTML = '<strong>Not quite.</strong> ' + feedback.innerHTML.split('</strong>')[1];
                    }
                });
            });
        });
    </script>
</body>
</html>

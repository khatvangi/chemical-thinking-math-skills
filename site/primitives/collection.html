<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COLLECTION | Counting Things</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0D1117;
            --bg-secondary: #161B22;
            --bg-tertiary: #21262D;
            --text-primary: #E6EDF3;
            --text-secondary: #8B949E;
            --text-muted: #6E7681;
            --accent-green: #7EE787;
            --accent-green-dim: #238636;
            --accent-blue: #58A6FF;
            --accent-purple: #A371F7;
            --accent-yellow: #F2CC60;
            --accent-red: #F85149;
            --accent-cyan: #79C0FF;
            --border-color: #30363D;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 17px;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            padding: 4rem 2rem 6rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .header-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-green);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        h1 {
            font-family: 'Fraunces', serif;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Main content */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Parts/Sections */
        .part {
            padding: 4rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .part:last-child {
            border-bottom: none;
        }

        .part-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .part-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-green);
            letter-spacing: 0.1em;
        }

        h2 {
            font-family: 'Fraunces', serif;
            font-size: 2rem;
            font-weight: 600;
            margin-top: 0.5rem;
            color: var(--text-primary);
        }

        h3 {
            font-family: 'Fraunces', serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent-green);
            margin: 2.5rem 0 1rem;
        }

        h4 {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 2rem 0 1rem;
        }

        p {
            margin-bottom: 1.2rem;
            color: var(--text-secondary);
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        em {
            color: var(--accent-green);
            font-style: italic;
        }

        /* Hook section */
        .hook {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2.5rem;
            margin: 3rem 0;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .hook-equation {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            color: var(--accent-green);
            margin: 1.5rem 0;
        }

        /* Definition popups */
        .def-popup {
            position: relative;
            color: var(--accent-blue);
            cursor: help;
            border-bottom: 1px dashed var(--accent-blue);
        }

        .def-popup .def-tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            padding: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 100;
            text-align: left;
            line-height: 1.5;
        }

        .def-popup:hover .def-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Visual containers */
        .visual-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2.5rem 0;
            border: 1px solid var(--border-color);
        }

        .visual-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-green);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1.5rem;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        input[type="range"] {
            width: 140px;
            accent-color: var(--accent-green);
        }

        .value-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-green);
        }

        button {
            padding: 0.75rem 1.5rem;
            background: var(--accent-green-dim);
            border: 1px solid var(--accent-green);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        button:hover {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-group button {
            padding: 0.5rem 1rem;
        }

        .btn-group button.active {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .result-display {
            text-align: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-top: 1rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .result-value {
            font-size: 1.5rem;
            color: var(--accent-green);
        }

        .result-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .caption {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-align: center;
            margin-top: 1rem;
            font-style: italic;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            color: var(--accent-green);
            font-weight: 500;
            background: var(--bg-tertiary);
        }

        td {
            color: var(--text-secondary);
        }

        /* Formula boxes */
        .formula-box {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-green);
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            border-radius: 0 8px 8px 0;
        }

        .formula-box .formula {
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .formula-box .explanation {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Definition block */
        .definition-block {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-green);
            border-radius: 12px;
            padding: 2rem;
            margin: 2.5rem 0;
        }

        .definition-block h3 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .definition-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .definition-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .definition-term {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-cyan);
            font-weight: 500;
        }

        .definition-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 0.25rem;
        }

        /* Hierarchy display */
        .hierarchy {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .hierarchy-item {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            color: var(--accent-cyan);
        }

        .hierarchy-arrow {
            color: var(--text-muted);
        }

        /* Endnotes */
        .endnotes {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .endnotes h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .endnote {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            padding-left: 2rem;
            text-indent: -2rem;
        }

        .endnote-ref {
            color: var(--accent-blue);
            font-weight: 500;
        }

        /* Subitizing game */
        .game-area {
            position: relative;
            width: 100%;
            height: 300px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-message {
            font-family: 'Fraunces', serif;
            font-size: 1.5rem;
            color: var(--text-muted);
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-box {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            color: var(--accent-green);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Number input buttons */
        .number-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .number-btn {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Isomer display */
        .isomer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .isomer-card {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .isomer-card canvas {
            margin-bottom: 0.5rem;
        }

        .isomer-name {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Navigation */
        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-green);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            margin: 1rem 0;
            transition: all 0.2s ease;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .nav-link:hover {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 3rem 0;
        }

        /* Responsive */
        @media (max-width: 600px) {
            h1 { font-size: 2.5rem; }
            h2 { font-size: 1.6rem; }
            .container { padding: 0 1rem; }
            .visual-container { padding: 1rem; }
            .hook { padding: 1.5rem; }
            .hook-equation { font-size: 1.5rem; }
        }
    
        /* Course Navigation */
        .course-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-subtle, rgba(255,255,255,0.08));
            padding: 0.75rem 1.5rem;
        }
        .course-nav-inner {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        .course-nav a {
            color: var(--text-secondary, #8B949E);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.2s;
        }
        .course-nav a:hover {
            color: #14b8a6;
        }
        .nav-breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .nav-breadcrumb .sep {
            color: var(--text-muted, #6e7681);
        }
        .nav-primitive-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
        }
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

    </style>
</head>
<body>
    <nav class="course-nav">
        <div class="course-nav-inner">
            <div class="nav-breadcrumb">
                <a href="../chem291/">CHEM 291</a>
                <span class="sep">/</span>
                <a href="../chem291/#primitives">Primitives</a>
                <span class="sep">/</span>
                <span class="nav-primitive-badge" style="color: #4a9eff; background: #4a9eff22;">COLLECTION</span>
            </div>
            <div class="nav-links">
                <a href="../lectures/all-lectures.html">All Lectures</a>
            </div>
        </div>
    </nav>

    <header class="header">
        <div class="header-label">Lecture 03 — Primitive</div>
        <h1>COLLECTION</h1>
        <p class="subtitle">The recognition that discrete, countable entities exist. The cognitive foundation of sets, cardinality, and the mole.</p>
    </header>

    <main class="container">
        <!-- The Hook -->
        <div class="hook">
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">A balanced chemical equation:</p>
            <div class="hook-equation">2 H₂ + O₂ → 2 H₂O</div>
            <p style="color: var(--text-secondary); margin: 0;">The coefficients — 2, 1, 2 — are counts. Chemistry is built on counting.</p>
        </div>

        <!-- Part I: From Numbers to Collections -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART I</div>
                <h2>From Numbers to Collections</h2>
            </div>

            <h3>1.1 What Lecture 2 Established</h3>
            <p>The previous lecture traced the hierarchy of number systems:</p>

            <div class="hierarchy">
                <span class="hierarchy-item">ℕ</span>
                <span class="hierarchy-arrow">→</span>
                <span class="hierarchy-item">ℤ</span>
                <span class="hierarchy-arrow">→</span>
                <span class="hierarchy-item">ℚ</span>
                <span class="hierarchy-arrow">→</span>
                <span class="hierarchy-item">ℝ</span>
                <span class="hierarchy-arrow">→</span>
                <span class="hierarchy-item">ℂ</span>
            </div>

            <p>Natural numbers (ℕ) emerged first — the counting numbers. Integers (ℤ) extended counting to include negatives. Rationals (ℚ) arose from division. Reals (ℝ) filled the gaps. Complex numbers (ℂ) completed the algebraic picture.</p>

            <p>But the foundation — the natural numbers — arose from something more basic than algebra. The natural numbers formalize <em>counting</em>. And counting requires something to count.</p>

            <h3>1.2 The Question Behind Numbers</h3>
            <p>What does it mean to count?</p>

            <p>Consider: you have three apples. You point to each in turn and say "one, two, three." The number three is the result. You have established a <span class="def-popup" data-definition="One-to-one correspondence (bijection): A pairing between two sets such that each element of the first set pairs with exactly one element of the second, and vice versa."><span class="def-tooltip"></span>one-to-one correspondence</span> between apples and the words {one, two, three}.</p>

            <p>This presupposes something: you must first perceive the apples as discrete, countable units. The visual scene must be parsed into bounded objects before enumeration can begin.</p>

            <p><span class="def-popup" data-definition="Object individuation: The cognitive process of parsing sensory input into discrete, bounded entities that can be tracked through space and time. Precedes enumeration."><span class="def-tooltip"></span>Object individuation</span> is the prerequisite for counting. You cannot count a continuous gradient. You can only count discrete units.</p>

            <p>The natural numbers formalize counting. Sets formalize the collections being counted. COLLECTION, as a cognitive primitive, is the perception that discrete countable units exist.</p>
        </section>

        <!-- Part II: The Cognitive Basis -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART II</div>
                <h2>The Cognitive Basis of Collection</h2>
            </div>

            <h3>2.1 Individuation</h3>
            <p>The sensory stream is continuous. Light gradients, pressure variations, acoustic waveforms — none come pre-divided into objects. The parsing of experience into discrete entities is accomplished by the perceptual system, beginning in infancy.</p>

            <p>By 4 months, human infants represent bounded objects that persist through brief occlusion. By 12 months, infants use shape differences to distinguish object kinds.</p>

            <p><span class="def-popup" data-definition="Sortal concept: A concept that provides criteria for (1) individuating members of a kind and (2) tracing their identity through time. Example: 'atom' specifies what counts as one atom."><span class="def-tooltip"></span>Sortal concepts</span> specify individuation criteria. Different sortals parse the same matter differently:</p>

            <table>
                <tr><th>Sortal</th><th>What counts as one?</th></tr>
                <tr><td>Atom</td><td>One nucleus + electrons</td></tr>
                <tr><td>Molecule</td><td>One bonded assembly</td></tr>
                <tr><td>Formula unit</td><td>One NaCl pair (ionic)</td></tr>
                <tr><td>Mole</td><td>6.022 × 10²³ of the above</td></tr>
            </table>

            <p>The mole is a second-order counting unit — it counts counts.</p>

            <h3>2.2 Two Systems for Numerosity</h3>

            <p>Humans (and many other animals) possess two distinct systems for perceiving quantity.</p>

            <h4>Subitizing</h4>
            <p>Immediate, exact perception of small quantities (1-4 items). Flash four dots on a screen for 200 milliseconds. You know there are four — instantly, without counting. Flash seven dots and you must either count or estimate.</p>

            <!-- Subitizing Interactive -->
            <div class="visual-container">
                <div class="visual-title">Subitizing Boundary</div>
                <div class="game-area" id="subitizeArea">
                    <div class="game-message" id="subitizeMessage">Press START to begin</div>
                </div>
                <div class="controls">
                    <button id="subitizeStart">START</button>
                </div>
                <div class="number-buttons" id="numberButtons" style="display: none;">
                    <button class="number-btn" data-n="1">1</button>
                    <button class="number-btn" data-n="2">2</button>
                    <button class="number-btn" data-n="3">3</button>
                    <button class="number-btn" data-n="4">4</button>
                    <button class="number-btn" data-n="5">5</button>
                    <button class="number-btn" data-n="6">6</button>
                    <button class="number-btn" data-n="7">7</button>
                    <button class="number-btn" data-n="8">8</button>
                </div>
                <div class="game-stats" id="subitizeStats" style="display: none;">
                    <div class="stat-box">
                        <div class="stat-value" id="statTrials">0</div>
                        <div class="stat-label">Trials</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="statCorrect">0%</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="statAvgTime">-</div>
                        <div class="stat-label">Avg Time (ms)</div>
                    </div>
                </div>
                <p class="caption">The subitizing boundary at ~4 reflects a limit on parallel object tracking.</p>
            </div>

            <h4>Approximate Number System (ANS)</h4>
            <p>Ratio-dependent estimation of larger quantities. The ANS follows <span class="def-popup" data-definition="Weber's law (for numerosity): The discriminability of two quantities depends on their ratio, not their absolute difference. Distinguishing 8 from 16 (ratio 1:2) is as easy as distinguishing 4 from 8."><span class="def-tooltip"></span>Weber's law</span>: discrimination accuracy depends on the ratio between quantities. Distinguishing 8 from 16 is easy (ratio 1:2). Distinguishing 8 from 9 is hard (ratio 8:9).</p>

            <!-- Weber's Law Interactive -->
            <div class="visual-container">
                <div class="visual-title">Weber's Law — Ratio Dependence</div>
                <canvas id="weberCanvas" width="700" height="300"></canvas>
                <div class="controls">
                    <button id="weberLeft">LEFT has more</button>
                    <button id="weberRight">RIGHT has more</button>
                </div>
                <div class="result-display">
                    <div class="result-value" id="weberResult">Click a button to guess</div>
                    <div class="result-label" id="weberRatio">Ratio will be shown</div>
                </div>
                <p class="caption">Accuracy depends on ratio, not absolute difference.</p>
            </div>

            <h3>2.3 From Perception to Symbol</h3>
            <p>The ANS and subitizing provide approximate or limited-range numerosity perception. Exact enumeration of large quantities requires external scaffolding: tallies, words, numerals.</p>

            <p>The oldest known tally marks are approximately 44,000 years old — notches carved on a baboon fibula. <span class="def-popup" data-definition="Tally marks: Physical marks (notches, strokes) representing single units. Tally systems externalize counting, extending it beyond working memory limits."><span class="def-tooltip"></span>Tally marks</span> implement one-to-one correspondence physically: one notch per day, one mark per animal.</p>

            <p>Number words formalize tally systems linguistically. Written numerals abstract further. The Hindu-Arabic system (0-9 in positional notation) enables representation of arbitrarily large numbers with a finite symbol set.</p>
        </section>

        <!-- Part III: Sets -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART III</div>
                <h2>Sets — The Formalization</h2>
            </div>

            <h3>3.1 What Is a Set?</h3>
            <p><span class="def-popup" data-definition="Set: A well-defined collection of distinct objects (elements). A set is determined entirely by its elements. Notation: {a, b, c} is the set containing exactly a, b, and c."><span class="def-tooltip"></span>A set</span> is a collection of distinct objects considered as a single mathematical entity.</p>

            <div class="formula-box">
                <div class="formula">Notation:</div>
                <div class="explanation">
                    {a, b, c} — the set containing a, b, and c<br>
                    x ∈ S — x is an element of S<br>
                    x ∉ S — x is not an element of S<br>
                    |S| — the cardinality of S
                </div>
            </div>

            <p><strong>Examples:</strong></p>
            <ul style="color: var(--text-secondary); margin-left: 1.5rem; margin-bottom: 1.5rem;">
                <li>{1, 2, 3} — a finite set of natural numbers</li>
                <li>{H, He, Li, Be, B, C, N, O, F, Ne} — the first ten elements</li>
                <li>{x ∈ ℕ : x is prime} = {2, 3, 5, 7, 11, ...} — an infinite set</li>
                <li>∅ or {} — the empty set</li>
            </ul>

            <h3>3.2 Set Operations</h3>

            <!-- Venn Diagram Interactive -->
            <div class="visual-container">
                <div class="visual-title">Set Operations</div>
                <canvas id="vennCanvas" width="700" height="350"></canvas>
                <div class="btn-group">
                    <button class="venn-btn" data-op="A">A</button>
                    <button class="venn-btn" data-op="B">B</button>
                    <button class="venn-btn active" data-op="union">A ∪ B</button>
                    <button class="venn-btn" data-op="intersection">A ∩ B</button>
                    <button class="venn-btn" data-op="diff-a">A − B</button>
                    <button class="venn-btn" data-op="diff-b">B − A</button>
                </div>
                <div class="result-display">
                    <div class="result-value" id="vennOp">A ∪ B</div>
                    <div class="result-label" id="vennDesc">Elements in A or B (or both)</div>
                </div>
            </div>

            <div class="formula-box">
                <div class="formula">Set Operations:</div>
                <div class="explanation">
                    <strong>Union</strong>: A ∪ B = {x : x ∈ A or x ∈ B}<br>
                    <strong>Intersection</strong>: A ∩ B = {x : x ∈ A and x ∈ B}<br>
                    <strong>Difference</strong>: A − B = {x : x ∈ A and x ∉ B}<br>
                    <strong>Complement</strong>: Aᶜ = {x : x ∉ A}
                </div>
            </div>

            <h3>3.3 The Power Set</h3>
            <p>The <span class="def-popup" data-definition="Power set P(S): The set of all subsets of S, including ∅ and S itself. If |S| = n, then |P(S)| = 2ⁿ."><span class="def-tooltip"></span>power set</span> P(S) is the set of all subsets of S.</p>

            <p>If S = {a, b}, then P(S) = {∅, {a}, {b}, {a, b}} — four subsets.</p>

            <div class="formula-box">
                <div class="formula">|P(S)| = 2ⁿ</div>
                <div class="explanation">Each element is either included or excluded — two choices per element, n elements total.</div>
            </div>

            <table>
                <tr><th>n</th><th>2ⁿ</th></tr>
                <tr><td>0</td><td>1</td></tr>
                <tr><td>3</td><td>8</td></tr>
                <tr><td>10</td><td>1,024</td></tr>
                <tr><td>20</td><td>1,048,576</td></tr>
            </table>
        </section>

        <!-- Part IV: Combinatorics -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART IV</div>
                <h2>Combinatorics — Counting Arrangements</h2>
            </div>

            <h3>4.1 The Factorial</h3>
            <p>Given n distinct objects, how many ways can they be arranged in sequence?</p>

            <p>For the first position: n choices. For the second: n − 1 remaining. For the third: n − 2. And so on.</p>

            <div class="formula-box">
                <div class="formula">n! = n × (n−1) × (n−2) × ... × 2 × 1</div>
                <div class="explanation">The factorial counts permutations of n distinct objects.</div>
            </div>

            <table>
                <tr><th>n</th><th>n!</th></tr>
                <tr><td>1</td><td>1</td></tr>
                <tr><td>3</td><td>6</td></tr>
                <tr><td>5</td><td>120</td></tr>
                <tr><td>10</td><td>3,628,800</td></tr>
                <tr><td>20</td><td>2.43 × 10¹⁸</td></tr>
            </table>

            <p>Factorials grow faster than exponentials. This rapid growth underlies the combinatorial explosion in chemical structure enumeration.</p>

            <h3>4.2 Permutations and Combinations</h3>

            <div class="formula-box">
                <div class="formula">P(n,k) = n!/(n−k)!</div>
                <div class="explanation"><strong>Permutation</strong>: Ordered arrangements of k objects from n. Order matters.</div>
            </div>

            <div class="formula-box">
                <div class="formula">C(n,k) = n!/[k!(n−k)!]</div>
                <div class="explanation"><strong>Combination</strong>: Unordered selections of k objects from n. Order does not matter.</div>
            </div>

            <p><strong>Example</strong>: A committee of 3 from 10 people. Order does not matter. Use combinations: C(10,3) = 120.</p>

            <p><strong>Example</strong>: Gold, silver, bronze medals for 10 competitors. Order matters. Use permutations: P(10,3) = 720.</p>

            <h3>4.3 Isomer Enumeration</h3>
            <p>The molecular formula C₄H₁₀ corresponds to two structural isomers. C₁₀H₂₂ has 75 isomers. C₄₀H₈₂ has over 62 trillion.</p>

            <!-- Isomer Counter -->
            <div class="visual-container">
                <div class="visual-title">Isomer Counting — Alkanes CₙH₂ₙ₊₂</div>
                <div class="controls">
                    <div class="control-group">
                        <label>Carbon atoms (n)</label>
                        <input type="range" id="isomerN" min="1" max="12" value="4">
                        <span class="value-display" id="isomerNVal">4</span>
                    </div>
                </div>
                <div class="result-display">
                    <div class="result-value" id="isomerCount">2 isomers</div>
                    <div class="result-label" id="isomerFormula">C₄H₁₀</div>
                </div>
                <div class="isomer-grid" id="isomerGrid"></div>
                <p class="caption">Combinatorial explosion: small increases in n yield huge increases in isomer count.</p>
            </div>
        </section>

        <!-- Part V: Collection in Chemistry -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART V</div>
                <h2>Collection in Chemistry</h2>
            </div>

            <h3>5.1 The Mole</h3>
            <p>Chemistry operates at scales where direct counting is impossible. A drop of water contains approximately 10²¹ molecules. Counting at one molecule per second would take ~30 trillion years.</p>

            <p><span class="def-popup" data-definition="Mole (mol): The SI unit of amount of substance. One mole contains exactly 6.02214076 × 10²³ entities (the Avogadro constant)."><span class="def-tooltip"></span>The mole</span> is a counting unit scaled for chemical quantities.</p>

            <div class="formula-box">
                <div class="formula">1 mol = 6.02214076 × 10²³ entities</div>
                <div class="explanation">Avogadro's constant Nₐ connects the atomic mass unit to the gram.</div>
            </div>

            <table>
                <tr><th>Quantity</th><th>Atomic scale</th><th>Molar scale</th></tr>
                <tr><td>Mass</td><td>12 u (one ¹²C atom)</td><td>12 g (one mole ¹²C)</td></tr>
                <tr><td>Number</td><td>1 atom</td><td>6.022 × 10²³ atoms</td></tr>
            </table>

            <h3>5.2 Counting by Weighing</h3>
            <p>Atoms cannot be counted directly. But they can be weighed. The mole provides the conversion factor.</p>

            <div class="formula-box">
                <div class="formula">n = m/M</div>
                <div class="explanation">n = amount (mol), m = mass (g), M = molar mass (g/mol)</div>
            </div>

            <h3>5.3 Stoichiometry</h3>
            <p><span class="def-popup" data-definition="Stoichiometry: The quantitative relationship between reactants and products in a chemical reaction, determined by the balanced equation coefficients."><span class="def-tooltip"></span>Stoichiometry</span> applies counting to chemical reactions.</p>

            <!-- Stoichiometry Scaling -->
            <div class="visual-container">
                <div class="visual-title">Stoichiometry — Scale Invariance</div>
                <canvas id="stoichCanvas" width="700" height="250"></canvas>
                <div class="controls">
                    <div class="control-group">
                        <label>Scale</label>
                        <input type="range" id="stoichScale" min="0" max="100" value="0">
                        <span class="value-display" id="stoichScaleVal">molecules</span>
                    </div>
                </div>
                <div class="result-display">
                    <div class="result-value" id="stoichEq">2 H₂ + 1 O₂ → 2 H₂O</div>
                    <div class="result-label" id="stoichMass">4 u + 32 u → 36 u</div>
                </div>
                <p class="caption">The ratio is constant across scales. Stoichiometry is counting.</p>
            </div>

            <p>Every stoichiometry problem is a counting problem:</p>
            <ol style="color: var(--text-secondary); margin-left: 1.5rem; margin-bottom: 1.5rem;">
                <li>Convert mass to moles (count)</li>
                <li>Apply mole ratio (counting ratio)</li>
                <li>Convert back to mass if needed</li>
            </ol>
        </section>

        <!-- Part VI: Formal Definitions -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART VI</div>
                <h2>Formal Definitions</h2>
            </div>

            <div class="definition-block">
                <h3>Core Concepts</h3>

                <div class="definition-item">
                    <div class="definition-term">Set</div>
                    <div class="definition-desc">A collection of distinct objects (elements). Notation: {a, b, c}.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Cardinality (|S|)</div>
                    <div class="definition-desc">The number of elements in set S.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Natural numbers (ℕ)</div>
                    <div class="definition-desc">{0, 1, 2, 3, ...} or {1, 2, 3, ...}. The counting numbers.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Factorial (n!)</div>
                    <div class="definition-desc">n × (n−1) × ... × 1. Counts arrangements of n objects.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Permutation P(n,k)</div>
                    <div class="definition-desc">n!/(n−k)!. Ordered arrangements of k from n.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Combination C(n,k)</div>
                    <div class="definition-desc">n!/[k!(n−k)!]. Unordered selections of k from n.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Mole (mol)</div>
                    <div class="definition-desc">SI unit of amount. Contains 6.02214076 × 10²³ entities.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Avogadro constant (Nₐ)</div>
                    <div class="definition-desc">6.02214076 × 10²³ mol⁻¹.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Molar mass (M)</div>
                    <div class="definition-desc">Mass per mole in g/mol.</div>
                </div>

                <div class="definition-item">
                    <div class="definition-term">Stoichiometry</div>
                    <div class="definition-desc">Quantitative relations in chemical reactions via mole ratios.</div>
                </div>
            </div>
        </section>

        <!-- Part VII: Forward -->
        <section class="part">
            <div class="part-header">
                <div class="part-number">PART VII</div>
                <h2>Forward</h2>
            </div>

            <h3>What COLLECTION Establishes</h3>
            <p>COLLECTION is the recognition that the world contains discrete, countable entities. This recognition is cognitively primitive — infants and animals individuate objects and perceive numerosity without symbolic training.</p>

            <p>Formalization yields:</p>
            <ul style="color: var(--text-secondary); margin-left: 1.5rem; margin-bottom: 1.5rem;">
                <li><strong>Sets</strong>: collections as mathematical objects</li>
                <li><strong>Cardinality</strong>: the measure of "how many"</li>
                <li><strong>Combinatorics</strong>: counting arrangements</li>
                <li><strong>The mole</strong>: a counting unit for chemistry</li>
            </ul>

            <h3>What Comes Next</h3>
            <p>With COLLECTION established, we can ask about the <em>properties</em> of the things collected.</p>

            <p><strong>Lecture 4 (DIRECTION)</strong>: Molecules have geometry. Bonds point somewhere. The water molecule's bond angle is 104.5°. Describing "where bonds point" requires the concept of direction, formalized as vectors.</p>

            <div class="formula-box">
                <div class="formula">COLLECTION → "How many atoms?"</div>
                <div class="explanation">DIRECTION → "Which way do they point?"</div>
            </div>

            <p>The transition from counting to geometry is the transition from sets to vectors — from cardinality to orientation.</p>
        </section>

        <!-- Endnotes -->
        <section class="endnotes">
            <h3>Endnotes</h3>
            <div class="endnote"><span class="endnote-ref">[1]</span> Spelke, E. (1990), "Principles of object perception," <em>Cognitive Science</em> 14:29-56.</div>
            <div class="endnote"><span class="endnote-ref">[2]</span> Baillargeon, R. (2004), "Infants' physical world," <em>Current Directions in Psychological Science</em> 13:89-94.</div>
            <div class="endnote"><span class="endnote-ref">[3]</span> Xu, F., & Carey, S. (1996), "Infants' metaphysics: The case of numerical identity," <em>Cognitive Psychology</em> 30:111-153.</div>
            <div class="endnote"><span class="endnote-ref">[4]</span> Kaufman, E., Lord, M., Reese, T., & Volkmann, J. (1949), "The discrimination of visual number," <em>American Journal of Psychology</em> 62:498-525.</div>
            <div class="endnote"><span class="endnote-ref">[5]</span> Piazza, M., et al. (2011), "Subitizing reflects visuo-spatial object individuation capacity," <em>Cognition</em> 121:147-153.</div>
            <div class="endnote"><span class="endnote-ref">[6]</span> Halberda, J., & Feigenson, L. (2008), "Developmental change in the acuity of the 'Number Sense'," <em>Developmental Psychology</em> 44:1457-1465.</div>
            <div class="endnote"><span class="endnote-ref">[7]</span> Feigenson, L., Dehaene, S., & Spelke, E. (2004), "Core systems of number," <em>Trends in Cognitive Sciences</em> 8:307-314.</div>
            <div class="endnote"><span class="endnote-ref">[8]</span> d'Errico, F., et al. (2012), "Early evidence of San material culture," <em>PNAS</em> 109:13214-13219.</div>
            <div class="endnote"><span class="endnote-ref">[9]</span> de Heinzelin, J. (1962), "Ishango," <em>Scientific American</em> 206:105-116.</div>
            <div class="endnote"><span class="endnote-ref">[10]</span> Ifrah, G. (2000), <em>The Universal History of Numbers</em>, Wiley.</div>
            <div class="endnote"><span class="endnote-ref">[11]</span> Cantor, G. (1874), "Über eine Eigenschaft des Inbegriffes aller reellen algebraischen Zahlen," <em>J. reine angew. Math.</em> 77:258-262.</div>
            <div class="endnote"><span class="endnote-ref">[12]</span> Cantor's diagonal argument demonstrates ℝ is uncountable. See Enderton, H. (1977), <em>Elements of Set Theory</em>.</div>
            <div class="endnote"><span class="endnote-ref">[13]</span> Sloane, N.J.A., "A000602: Number of n-node unrooted quartic trees," <em>OEIS</em>.</div>
            <div class="endnote"><span class="endnote-ref">[14]</span> Pólya, G. (1937), "Kombinatorische Anzahlbestimmungen für Gruppen, Graphen und chemische Verbindungen," <em>Acta Math.</em> 68:145-254.</div>
            <div class="endnote"><span class="endnote-ref">[15]</span> One mole of water ≈ 18 mL. One drop ≈ 0.05 mL ≈ 1.7 × 10²¹ molecules.</div>
        </section>

        <!-- Navigation -->
        <div class="nav-buttons">
            <a href="../index.html" class="nav-link">← Back to Lectures</a>
            <a href="../04-direction/sec1-what-points.html" class="nav-link">Next: DIRECTION →</a>
        </div>
    </main>

    <script>
        // === Populate Definition Tooltips ===
        document.querySelectorAll('.def-popup').forEach(el => {
            const tooltip = el.querySelector('.def-tooltip');
            if (tooltip && el.dataset.definition) {
                tooltip.textContent = el.dataset.definition;
            }
        });

        // === Subitizing Game ===
        const subitizeArea = document.getElementById('subitizeArea');
        const subitizeMessage = document.getElementById('subitizeMessage');
        const subitizeStart = document.getElementById('subitizeStart');
        const numberButtons = document.getElementById('numberButtons');
        const subitizeStats = document.getElementById('subitizeStats');

        let subitizeState = {
            trials: 0,
            correct: 0,
            times: [],
            currentN: 0,
            startTime: 0,
            dots: []
        };

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        subitizeStart.addEventListener('click', () => {
            subitizeState.trials = 0;
            subitizeState.correct = 0;
            subitizeState.times = [];
            subitizeStats.style.display = 'grid';
            runSubitizeTrial();
        });

        function runSubitizeTrial() {
            // Random number of dots 1-8
            subitizeState.currentN = Math.floor(Math.random() * 8) + 1;
            subitizeState.dots = [];

            // Generate non-overlapping positions
            const areaRect = subitizeArea.getBoundingClientRect();
            const dotSize = 30;
            const padding = 40;

            for (let i = 0; i < subitizeState.currentN; i++) {
                let attempts = 0;
                let x, y, valid;
                do {
                    x = padding + Math.random() * (areaRect.width - 2 * padding);
                    y = padding + Math.random() * (areaRect.height - 2 * padding);
                    valid = true;
                    for (const dot of subitizeState.dots) {
                        const dist = Math.sqrt((x - dot.x) ** 2 + (y - dot.y) ** 2);
                        if (dist < dotSize + 10) {
                            valid = false;
                            break;
                        }
                    }
                    attempts++;
                } while (!valid && attempts < 100);
                subitizeState.dots.push({ x, y });
            }

            // Clear and show dots
            subitizeMessage.style.display = 'none';
            subitizeArea.innerHTML = '';
            numberButtons.style.display = 'none';

            subitizeState.dots.forEach(dot => {
                const el = document.createElement('div');
                el.style.cssText = `
                    position: absolute;
                    left: ${dot.x - dotSize/2}px;
                    top: ${dot.y - dotSize/2}px;
                    width: ${dotSize}px;
                    height: ${dotSize}px;
                    background: var(--accent-green);
                    border-radius: 50%;
                `;
                subitizeArea.appendChild(el);
            });

            // Flash for 200ms
            subitizeState.startTime = performance.now();

            setTimeout(() => {
                subitizeArea.innerHTML = '';
                subitizeMessage.textContent = 'How many dots?';
                subitizeMessage.style.display = 'block';
                numberButtons.style.display = 'flex';
            }, 200);
        }

        document.querySelectorAll('.number-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const guess = parseInt(btn.dataset.n);
                const responseTime = performance.now() - subitizeState.startTime;

                subitizeState.trials++;
                if (guess === subitizeState.currentN) {
                    subitizeState.correct++;
                    subitizeMessage.textContent = `✓ Correct! (${subitizeState.currentN} dots)`;
                    subitizeMessage.style.color = 'var(--accent-green)';
                } else {
                    subitizeMessage.textContent = `✗ It was ${subitizeState.currentN} dots`;
                    subitizeMessage.style.color = 'var(--accent-red)';
                }
                subitizeState.times.push(responseTime);

                // Update stats
                document.getElementById('statTrials').textContent = subitizeState.trials;
                document.getElementById('statCorrect').textContent =
                    Math.round(subitizeState.correct / subitizeState.trials * 100) + '%';
                const avgTime = subitizeState.times.reduce((a, b) => a + b, 0) / subitizeState.times.length;
                document.getElementById('statAvgTime').textContent = Math.round(avgTime);

                numberButtons.style.display = 'none';

                // Next trial after delay
                setTimeout(() => {
                    subitizeMessage.style.color = 'var(--text-muted)';
                    runSubitizeTrial();
                }, 1500);
            });
        });

        // === Weber's Law ===
        const weberCanvas = document.getElementById('weberCanvas');
        const weberCtx = weberCanvas.getContext('2d');
        let weberState = { leftN: 0, rightN: 0 };

        function generateWeberTrial() {
            // Generate two counts with varying ratios
            const base = Math.floor(Math.random() * 20) + 10;
            const ratios = [1.1, 1.2, 1.3, 1.5, 2.0];
            const ratio = ratios[Math.floor(Math.random() * ratios.length)];
            const larger = Math.round(base * ratio);

            if (Math.random() < 0.5) {
                weberState.leftN = larger;
                weberState.rightN = base;
            } else {
                weberState.leftN = base;
                weberState.rightN = larger;
            }

            drawWeberDots();
            document.getElementById('weberResult').textContent = 'Which side has more?';
            document.getElementById('weberRatio').textContent = '';
        }

        function drawWeberDots() {
            weberCtx.fillStyle = '#21262D';
            weberCtx.fillRect(0, 0, 700, 300);

            // Divider
            weberCtx.strokeStyle = '#30363D';
            weberCtx.lineWidth = 2;
            weberCtx.beginPath();
            weberCtx.moveTo(350, 30);
            weberCtx.lineTo(350, 270);
            weberCtx.stroke();

            // Labels
            weberCtx.fillStyle = '#6E7681';
            weberCtx.font = '14px JetBrains Mono';
            weberCtx.textAlign = 'center';
            weberCtx.fillText('LEFT', 175, 25);
            weberCtx.fillText('RIGHT', 525, 25);

            // Draw dots
            drawDotCloud(weberCtx, 30, 40, 290, 220, weberState.leftN);
            drawDotCloud(weberCtx, 380, 40, 290, 220, weberState.rightN);
        }

        function drawDotCloud(ctx, x, y, w, h, n) {
            const dotSize = 10;
            const positions = [];

            for (let i = 0; i < n; i++) {
                let px, py, valid, attempts = 0;
                do {
                    px = x + Math.random() * w;
                    py = y + Math.random() * h;
                    valid = true;
                    for (const pos of positions) {
                        if (Math.sqrt((px - pos.x) ** 2 + (py - pos.y) ** 2) < dotSize + 3) {
                            valid = false;
                            break;
                        }
                    }
                    attempts++;
                } while (!valid && attempts < 50);

                positions.push({ x: px, y: py });
                ctx.beginPath();
                ctx.arc(px, py, dotSize / 2, 0, Math.PI * 2);
                ctx.fillStyle = '#7EE787';
                ctx.fill();
            }
        }

        document.getElementById('weberLeft').addEventListener('click', () => checkWeber('left'));
        document.getElementById('weberRight').addEventListener('click', () => checkWeber('right'));

        function checkWeber(choice) {
            const correct = (choice === 'left' && weberState.leftN > weberState.rightN) ||
                           (choice === 'right' && weberState.rightN > weberState.leftN);

            const ratio = Math.max(weberState.leftN, weberState.rightN) /
                         Math.min(weberState.leftN, weberState.rightN);

            document.getElementById('weberResult').textContent =
                correct ? '✓ Correct!' : '✗ Wrong!';
            document.getElementById('weberResult').style.color =
                correct ? 'var(--accent-green)' : 'var(--accent-red)';
            document.getElementById('weberRatio').textContent =
                `Left: ${weberState.leftN}, Right: ${weberState.rightN} (ratio ${ratio.toFixed(2)}:1)`;

            setTimeout(() => {
                document.getElementById('weberResult').style.color = 'var(--accent-green)';
                generateWeberTrial();
            }, 2000);
        }

        generateWeberTrial();

        // === Venn Diagram ===
        const vennCanvas = document.getElementById('vennCanvas');
        const vennCtx = vennCanvas.getContext('2d');
        let currentVennOp = 'union';

        const vennDescriptions = {
            'A': { label: 'A', desc: 'Elements in set A only' },
            'B': { label: 'B', desc: 'Elements in set B only' },
            'union': { label: 'A ∪ B', desc: 'Elements in A or B (or both)' },
            'intersection': { label: 'A ∩ B', desc: 'Elements in both A and B' },
            'diff-a': { label: 'A − B', desc: 'Elements in A but not in B' },
            'diff-b': { label: 'B − A', desc: 'Elements in B but not in A' }
        };

        function drawVenn() {
            vennCtx.fillStyle = '#161B22';
            vennCtx.fillRect(0, 0, 700, 350);

            const cx1 = 280, cx2 = 420, cy = 175, r = 120;

            // Draw based on operation
            vennCtx.globalAlpha = 0.3;

            // Background circles
            vennCtx.beginPath();
            vennCtx.arc(cx1, cy, r, 0, Math.PI * 2);
            vennCtx.fillStyle = '#58A6FF';
            if (currentVennOp === 'A' || currentVennOp === 'union' || currentVennOp === 'diff-a') {
                vennCtx.globalAlpha = 0.5;
            } else {
                vennCtx.globalAlpha = 0.15;
            }
            vennCtx.fill();

            vennCtx.beginPath();
            vennCtx.arc(cx2, cy, r, 0, Math.PI * 2);
            vennCtx.fillStyle = '#7EE787';
            if (currentVennOp === 'B' || currentVennOp === 'union' || currentVennOp === 'diff-b') {
                vennCtx.globalAlpha = 0.5;
            } else {
                vennCtx.globalAlpha = 0.15;
            }
            vennCtx.fill();

            // Intersection highlight
            if (currentVennOp === 'intersection' || currentVennOp === 'union') {
                vennCtx.globalAlpha = 0.6;
                vennCtx.beginPath();
                vennCtx.arc(cx1, cy, r, 0, Math.PI * 2);
                vennCtx.clip();
                vennCtx.beginPath();
                vennCtx.arc(cx2, cy, r, 0, Math.PI * 2);
                vennCtx.fillStyle = currentVennOp === 'intersection' ? '#F2CC60' : '#A371F7';
                vennCtx.fill();
                vennCtx.restore();
            }

            // Reset and draw outlines
            vennCtx.globalAlpha = 1;
            vennCtx.save();
            vennCtx.beginPath();
            vennCtx.arc(cx1, cy, r, 0, Math.PI * 2);
            vennCtx.strokeStyle = '#58A6FF';
            vennCtx.lineWidth = 3;
            vennCtx.stroke();

            vennCtx.beginPath();
            vennCtx.arc(cx2, cy, r, 0, Math.PI * 2);
            vennCtx.strokeStyle = '#7EE787';
            vennCtx.stroke();
            vennCtx.restore();

            // Labels
            vennCtx.fillStyle = '#E6EDF3';
            vennCtx.font = '24px Fraunces';
            vennCtx.textAlign = 'center';
            vennCtx.fillText('A', cx1 - 50, cy + 8);
            vennCtx.fillText('B', cx2 + 50, cy + 8);
        }

        document.querySelectorAll('.venn-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.venn-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentVennOp = btn.dataset.op;
                drawVenn();
                document.getElementById('vennOp').textContent = vennDescriptions[currentVennOp].label;
                document.getElementById('vennDesc').textContent = vennDescriptions[currentVennOp].desc;
            });
        });

        drawVenn();

        // === Isomer Counter ===
        const isomerSlider = document.getElementById('isomerN');
        const isomerCounts = [1, 1, 1, 2, 3, 5, 9, 18, 35, 75, 159, 355]; // n = 1 to 12
        const isomerNames = {
            1: ['Methane'],
            2: ['Ethane'],
            3: ['Propane'],
            4: ['n-Butane', 'Isobutane'],
            5: ['n-Pentane', 'Isopentane', 'Neopentane']
        };

        function updateIsomers() {
            const n = parseInt(isomerSlider.value);
            document.getElementById('isomerNVal').textContent = n;
            document.getElementById('isomerCount').textContent = isomerCounts[n - 1] + ' isomer' + (isomerCounts[n - 1] > 1 ? 's' : '');

            // Subscript formatting
            document.getElementById('isomerFormula').innerHTML = `C<sub>${n}</sub>H<sub>${2*n + 2}</sub>`;

            // Show isomer names for small n
            const grid = document.getElementById('isomerGrid');
            grid.innerHTML = '';

            if (n <= 5 && isomerNames[n]) {
                isomerNames[n].forEach(name => {
                    const card = document.createElement('div');
                    card.className = 'isomer-card';
                    card.innerHTML = `<div class="isomer-name">${name}</div>`;
                    grid.appendChild(card);
                });
            } else if (n > 5) {
                grid.innerHTML = '<p style="color: var(--text-muted); text-align: center; grid-column: 1/-1;">Too many isomers to display individually</p>';
            }
        }

        isomerSlider.addEventListener('input', updateIsomers);
        updateIsomers();

        // === Stoichiometry Scaling ===
        const stoichCanvas = document.getElementById('stoichCanvas');
        const stoichCtx = stoichCanvas.getContext('2d');
        const stoichSlider = document.getElementById('stoichScale');

        const stoichScales = [
            { label: 'molecules', h2: '2', o2: '1', h2o: '2', mass: '4 u + 32 u → 36 u' },
            { label: 'dozen', h2: '24', o2: '12', h2o: '24', mass: '48 u + 384 u → 432 u' },
            { label: 'thousand', h2: '2,000', o2: '1,000', h2o: '2,000', mass: '4,000 u + 32,000 u → 36,000 u' },
            { label: 'moles', h2: '2 mol', o2: '1 mol', h2o: '2 mol', mass: '4 g + 32 g → 36 g' }
        ];

        function drawStoich() {
            const val = parseInt(stoichSlider.value);
            const scaleIdx = Math.floor(val / 34);
            const scale = stoichScales[Math.min(scaleIdx, 3)];

            stoichCtx.fillStyle = '#161B22';
            stoichCtx.fillRect(0, 0, 700, 250);

            // Draw molecules
            const y = 125;

            // H2 molecules
            drawH2(stoichCtx, 80, y, val);
            drawH2(stoichCtx, 140, y, val);

            // Plus sign
            stoichCtx.fillStyle = '#E6EDF3';
            stoichCtx.font = '30px Inter';
            stoichCtx.textAlign = 'center';
            stoichCtx.fillText('+', 200, y + 10);

            // O2 molecule
            drawO2(stoichCtx, 280, y, val);

            // Arrow
            stoichCtx.fillStyle = '#7EE787';
            stoichCtx.font = '30px Inter';
            stoichCtx.fillText('→', 380, y + 10);

            // H2O molecules
            drawH2O(stoichCtx, 480, y, val);
            drawH2O(stoichCtx, 580, y, val);

            // Update displays
            document.getElementById('stoichScaleVal').textContent = scale.label;
            document.getElementById('stoichEq').textContent = `${scale.h2} H₂ + ${scale.o2} O₂ → ${scale.h2o} H₂O`;
            document.getElementById('stoichMass').textContent = scale.mass;
        }

        function drawH2(ctx, x, y, scale) {
            const size = 15 + scale * 0.1;
            ctx.fillStyle = '#E6EDF3';
            ctx.beginPath();
            ctx.arc(x - 12, y, size, 0, Math.PI * 2);
            ctx.arc(x + 12, y, size, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#161B22';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('H', x - 12, y + 4);
            ctx.fillText('H', x + 12, y + 4);
        }

        function drawO2(ctx, x, y, scale) {
            const size = 18 + scale * 0.1;
            ctx.fillStyle = '#F85149';
            ctx.beginPath();
            ctx.arc(x - 15, y, size, 0, Math.PI * 2);
            ctx.arc(x + 15, y, size, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#E6EDF3';
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('O', x - 15, y + 5);
            ctx.fillText('O', x + 15, y + 5);
        }

        function drawH2O(ctx, x, y, scale) {
            const size = 12 + scale * 0.08;
            const oSize = 16 + scale * 0.1;

            // Oxygen
            ctx.fillStyle = '#F85149';
            ctx.beginPath();
            ctx.arc(x, y, oSize, 0, Math.PI * 2);
            ctx.fill();

            // Hydrogens
            ctx.fillStyle = '#E6EDF3';
            ctx.beginPath();
            ctx.arc(x - 22, y - 15, size, 0, Math.PI * 2);
            ctx.arc(x + 22, y - 15, size, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#E6EDF3';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('O', x, y + 4);
            ctx.fillStyle = '#161B22';
            ctx.font = '10px Inter';
            ctx.fillText('H', x - 22, y - 12);
            ctx.fillText('H', x + 22, y - 12);
        }

        stoichSlider.addEventListener('input', drawStoich);
        drawStoich();
    </script>
</body>
</html>
